<!-- Create Post Button for Mobile -->
<!-- Search Form -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">Tìm kiếm</h5>
        <form action="/forum" method="GET">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Nhập từ khóa..." value="<%= filters.q || '' %>">
                <input type="hidden" name="sort" value="<%= filters.sort || 'latest' %>">
                <input type="hidden" name="category" value="<%= filters.category || 'all' %>">
                <button class="btn btn-outline-secondary" type="submit"><i class="fas fa-search"></i></button>
            </div>
        </form>
    </div>
</div>

<!-- Categories List -->
<div class="card">
    <div class="card-body">
        <h5 class="card-title">Danh mục</h5>
        <div class="list-group list-group-flush">
            <a href="/forum?sort=<%= filters.sort || 'latest' %>&q=<%= filters.q || '' %>&category=all" 
               class="list-group-item list-group-item-action d-flex justify-content-between align-items-center <%= filters.category === 'all' ? 'active' : '' %>">
                Tất cả bài đăng
                <span class="badge bg-secondary rounded-pill"><%= totalPosts || 0 %></span>
            </a>
            <% if (categories && categories.length > 0) { %>
                <% categories.forEach(cat => { %>
                    <%# LỚP BẢO VỆ: Chỉ hiển thị nếu category ID là một chuỗi hợp lệ %>
                    <% if (cat && typeof cat._id === 'string' && cat._id.trim() !== '') { %>
                        <a href="/forum?sort=<%= filters.sort || 'latest' %>&q=<%= filters.q || '' %>&category=<%= cat._id %>" 
                           class="list-group-item list-group-item-action d-flex justify-content-between align-items-center <%= filters.category === cat._id ? 'active' : '' %>">
                            <%= cat._id.charAt(0).toUpperCase() + cat._id.slice(1) %>
                            <span class="badge bg-secondary rounded-pill"><%= cat.count || 0 %></span>
                        </a>
                    <% } %>
                <% }); %>
            <% } %>
        </div>
    </div>
</div>

