<div class="container my-5">
  <a href="/wellness" class="back-link mb-4 d-inline-block"><i class="fas fa-arrow-left"></i> Quay lại Góc sức khỏe</a>
  
  <div class="text-center mb-5">
    <h1><i class="fas fa-question-circle text-primary"></i> Hỏi đáp ẩn danh</h1>
    <p class="lead text-muted">Mọi câu hỏi đều đáng được lắng nghe. Mọi thông tin bạn chia sẻ đều được bảo mật.</p>
  </div>
  
  <div class="card p-4 mb-5 mx-auto shadow-sm" style="max-width: 800px;">
    <h5 class="card-title mb-3">Gửi câu hỏi mới</h5>
    <form action="/wellness/ask" method="POST">
      <div class="mb-3">
        <textarea class="form-control" name="questionContent" rows="4" placeholder="Bạn có điều gì băn khoăn? Hãy chia sẻ ở đây..." required></textarea>
      </div>
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-paper-plane me-2"></i>Gửi câu hỏi ẩn danh
      </button>
    </form>
  </div>

  <div class="discussion-list mx-auto" style="max-width: 800px;">
    <h3 class="mb-4">Cùng nhau thảo luận</h3>
    <% if (questions && questions.length > 0) { %>
      <% questions.forEach(question => { %>
        <div class="card mb-4">
          <div class="card-header bg-light">
            <div class="d-flex align-items-center">
              <i class="fas fa-user-secret fa-2x text-muted me-3"></i>
              <div>
                <strong>Người hỏi ẩn danh #<%= question.anonymousId %></strong>
                <div class="text-muted small">
                  <%= new Date(question.createdAt).toLocaleString('vi-VN') %>
                </div>
              </div>
            </div>
          </div>
          <div class="card-body">
            <p class="card-text fs-5"><%= question.content %></p>
          </div>
          <div class="replies-section px-4 pb-3">
            <% if (question.replies && question.replies.length > 0) { %>
              <h6 class="mb-3">Các câu trả lời:</h6>
              <% question.replies.forEach(reply => { %>
                <div class="d-flex mt-3">
                  <div class="flex-shrink-0">
                    <img src="<%= reply.user.avatar || '/images/default-avatar.png' %>" alt="avatar" class="rounded-circle" width="40" height="40">
                  </div>
                  <div class="ms-3 flex-grow-1">
                    <div class="bg-light p-2 rounded">
                      <strong><%= reply.user.fullName %></strong>
                      <p class="mb-0 small"><%= reply.content %></p>
                    </div>
                  </div>
                </div>
              <% }); %>
            <% } else { %>
              <p class="text-muted small ps-1">Chưa có câu trả lời nào.</p>
            <% } %>
          </div>
          <div class="card-footer">
            <% if (user) { %>
              <form action="/wellness/ask/<%= question._id %>/reply" method="POST" class="d-flex">
                <input type="text" class="form-control me-2" name="replyContent" placeholder="Viết câu trả lời của bạn..." required>
                <button type="submit" class="btn btn-outline-primary btn-sm">Gửi</button>
              </form>
            <% } else { %>
              <p class="text-muted mb-0 small text-center">
                <a href="/login">Đăng nhập</a> để tham gia thảo luận.
              </p>
            <% } %>
          </div>
        </div>
      <% }); %>
    <% } else { %>
      <p class="text-center text-muted">Chưa có câu hỏi nào được gửi. Hãy là người đầu tiên đặt câu hỏi!</p>
    <% } %>

    <% if (totalPages > 1) { %>
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
          <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
            <a class="page-link" href="/wellness/ask?page=<%= currentPage - 1 %>">Trước</a>
          </li>
          <% for (let i = 1; i <= totalPages; i++) { %>
            <li class="page-item <%= i === currentPage ? 'active' : '' %>">
              <a class="page-link" href="/wellness/ask?page=<%= i %>"><%= i %></a>
            </li>
          <% } %>
          <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
            <a class="page-link" href="/wellness/ask?page=<%= currentPage + 1 %>">Sau</a>
          </li>
        </ul>
      </nav>
    <% } %>
  </div>
</div>
