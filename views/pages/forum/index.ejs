<style>
    .filter-nav .nav-link { color: #6c757d; border-bottom: 3px solid transparent; padding-bottom: 0.5rem; }
    .filter-nav .nav-link.active { color: #0d6efd; border-bottom-color: #0d6efd; font-weight: 500; }
    .post-item:hover { background-color: #f8f9fa; }
    .sticky-post { background-color: #fffbe6; border-left: 4px solid #ffc107; }
    .post-avatar { width: 50px; height: 50px; object-fit: cover; }
</style>

<div class="container-fluid px-lg-5 my-5">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-9">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
                <div>
                    <h1><i class="fas fa-comments text-success"></i> Diễn đàn cộng đồng</h1>
                    <p class="lead text-muted mb-0">Nơi sinh viên cùng nhau thảo luận và chia sẻ kinh nghiệm.</p>
                </div>
                <a href="/forum/create" class="btn btn-primary btn-lg mt-3 mt-md-0 d-none d-lg-block">
                    <i class="fas fa-plus-circle"></i> Tạo bài đăng
                </a>
            </div>

            <!-- Filters -->
            <div class="card mb-4">
                <div class="card-body p-2">
                    <ul class="nav nav-pills filter-nav">
                        <li class="nav-item">
                            <a class="nav-link <%= filters.sort === 'latest' ? 'active' : '' %>" href="?sort=latest&category=<%= filters.category %>&q=<%= filters.q || '' %>">Mới nhất</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link <%= filters.sort === 'popular' ? 'active' : '' %>" href="?sort=popular&category=<%= filters.category %>&q=<%= filters.q || '' %>">Nổi bật</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link <%= filters.sort === 'discussed' ? 'active' : '' %>" href="?sort=discussed&category=<%= filters.category %>&q=<%= filters.q || '' %>">Thảo luận nhiều</a>
                        </li>
                    </ul>
                </div>
            </div>

            <% if (typeof error !== 'undefined' && error) { %>
                <div class="alert alert-danger"><%= error %></div>
            <% } %>

            <!-- Posts List -->
            <div class="list-group">
                <% if (stickyPosts && stickyPosts.length > 0 && currentPage === 1 && !filters.q) { %>
                    <% stickyPosts.forEach(post => { %>
                        <%# SỬA LỖI ĐƯỜNG DẪN: ../../partials/ %>
                        <%- include('../../partials/_postListItem', { post: post, isSticky: true }) %>
                    <% }); %>
                <% } %>
                
                <% if (posts && posts.length > 0) { %>
                    <% posts.forEach(post => { %>
                        <%# SỬA LỖI ĐƯỜNG DẪN: ../../partials/ %>
                        <%- include('../../partials/_postListItem', { post: post, isSticky: false }) %>
                    <% }); %>
                <% } else if ((!stickyPosts || stickyPosts.length === 0) && (!posts || posts.length === 0)) { %>
                    <div class="text-center p-5 border rounded bg-light">
                        <h4><i class="fas fa-search"></i> Không tìm thấy bài đăng nào</h4>
                        <p class="text-muted">Chưa có bài đăng nào. Hãy là người đầu tiên tạo một chủ đề mới!</p>
                    </div>
                <% } %>
            </div>

            <!-- Pagination -->
            <%# SỬA LỖI ĐƯỜNG DẪN: ../../partials/ %>
            <%- include('../../partials/pagination', {
                currentPage: currentPage,
                totalPages: totalPages,
                baseUrl: `/forum?sort=${filters.sort}&category=${filters.category}&q=${filters.q || ''}`
            }) %>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-3">
            <%# SỬA LỖI ĐƯỜNG DẪN: ../../partials/ %>
            <%- include('../../partials/_forumSidebar', { categories, filters, totalPosts, user }) %>
        </div>
    </div>
</div>

